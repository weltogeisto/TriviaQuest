<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>TriviaQuest ‚Äî Masters Level Edition</title>
<style>
  :root{
    --bg1:#1a1040; --bg2:#2a0f5a;
    --glass: rgba(255,255,255,.06);
    --border: #ffffff1a;
    --text:#e9eef6; --muted:#a9b7d0;
    --accent:#7dd3fc; --ok:#22c55e; --warn:#facc15; --danger:#ef4444;
    --card-shadow: 0 10px 30px rgba(0,0,0,.25);
  }
  *{box-sizing:border-box}
  html,body{
    margin:0;
    background:radial-gradient(1200px 800px at 20% -10%,#4c1d95 0,#2a0f5a 50%,#120a2b 100%);
    color:var(--text);
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial
  }
  .wrap{max-width:1120px;margin:0 auto;padding:28px 20px 60px}
  .glass{background:linear-gradient(180deg,var(--glass),transparent);border:1px solid var(--border);backdrop-filter:blur(6px)}
  .card{border-radius:18px;padding:18px;box-shadow:var(--card-shadow)}
  h1{margin:0 0 8px;font-size:clamp(26px,3.5vw,40px);letter-spacing:.2px}
  .sub{margin:0;color:var(--muted)}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;border:1px solid var(--border);background:#ffffff14;font-size:12px}
  .meta{display:inline-flex;gap:8px;align-items:center}
  .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#ffffff12;color:#fff;cursor:pointer;text-decoration:none;font-weight:600}
  .btn:hover{background:#ffffff22}
  .ghost{background:#ffffff0a}
  .big{padding:12px 16px;border-radius:14px}
  .hidden{display:none}
  .grid{display:grid;gap:16px}
  @media(min-width:860px){.grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}

  /* category cards */
  .cat{position:relative;overflow:hidden}
  .cat h3{margin:2px 0 4px;font-size:20px}
  .cat p{margin:0 0 8px;color:var(--muted);font-size:14px}
  .tag{position:absolute;top:14px;right:14px;font-size:12px}
  .badge{position:absolute;left:14px;top:14px;font-size:12px;background:#00000040}
  .chip{display:inline-flex;align-items:center;gap:6px;font-size:12px;padding:3px 8px;border-radius:999px;border:1px solid var(--border);background:#ffffff12}
  .start{margin-top:8px}
  .c_orange{background:linear-gradient(160deg,#ff7a18 0,#ffb44c 100%)}
  .c_green{background:linear-gradient(160deg,#10b981 0,#22d3ee 100%)}
  .c_blue{background:linear-gradient(160deg,#2563eb 0,#7c3aed 100%)}
  .c_purple{background:linear-gradient(160deg,#a855f7 0,#ec4899 100%)}
  .c_teal{background:linear-gradient(160deg,#06b6d4 0,#34d399 100%)}
  .c_emerald{background:linear-gradient(160deg,#059669 0,#22c55e 100%)}
  .c_rose{background:linear-gradient(160deg,#f43f5e 0,#fb7185 100%)}
  .cat .overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.28),rgba(0,0,0,.32))}
  .cat .content{position:relative}

  /* game */
  .bar{height:8px;border-radius:999px;background:#ffffff14;overflow:hidden;margin:10px 0 16px}
  .fill{height:100%;background:linear-gradient(90deg,#22c55e,#3b82f6)}
  .q{font-size:20px;font-weight:700;margin:6px 0 12px}
  .opt{border:1px solid var(--border);background:#ffffff0e;border-radius:14px;padding:12px;margin:10px 0;cursor:pointer}
  .opt:hover{background:#ffffff1b}
  .opt.correct{border-color:#22c55e;background:#22c55e22}
  .opt.wrong{border-color:#ef4444;background:#ef444422}
  .muted{color:var(--muted)}
  .foot{opacity:.8;font-size:12px}
  details>summary{cursor:pointer}
  select,input{background:#fff;color:#111;border-radius:10px;border:none;padding:8px 10px}
  code{background:#00000033;padding:1px 6px;border-radius:6px}
</style>
</head>
<body>
<div class="wrap">

  <!-- Header -->
  <header class="glass card" style="display:flex;gap:16px;align-items:center">
    <div class="pill">üß† Ready</div>
    <div>
      <h1>TriviaQuest</h1>
      <p class="sub">Advanced academic trivia for graduate students</p>
      <div class="meta" style="margin-top:6px">
        <span class="pill">‚è±Ô∏è 45s / question</span>
        <span class="pill">üîÅ 10 per round</span>
        <span class="pill">üß™ Masters-level</span>
      </div>
    </div>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <button id="btnHome" class="btn hidden">üè† Home</button>
    </div>
  </header>

  <!-- HOME -->
  <section id="screen-home" class="glass card" style="margin-top:18px">
    <div class="grid cols-3">

      <div class="cat card c_orange">
        <div class="overlay"></div>
        <div class="content">
          <span class="badge pill">‚≠ê META</span>
          <span class="tag pill">45s</span>
          <h3>Incredible India</h3>
          <p>Masters-level India across disciplines</p>
          <div class="chip">üì¶ <span data-count="india">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="india">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_green">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>Geography</h3>
          <p>Advanced physical & human geography</p>
          <div class="chip">üì¶ <span data-count="geography">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="geography">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_blue">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>Science</h3>
          <p>Physics, biology, chemistry & more</p>
          <div class="chip">üì¶ <span data-count="science">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="science">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_purple">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>History</h3>
          <p>Global historical events and figures</p>
          <div class="chip">üì¶ <span data-count="history">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="history">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_teal">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>Arts & Culture</h3>
          <p>Visual arts, music, and literature</p>
          <div class="chip">üì¶ <span data-count="arts">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="arts">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_emerald">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>Tolkien & Middle-earth</h3>
          <p>Lore from The Lord of the Rings</p>
          <div class="chip">üì¶ <span data-count="tolkien">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="tolkien">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_rose">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>Wortschatz (B2)</h3>
          <p>German vocabulary practice</p>
          <div class="chip">üì¶ <span data-count="wortschatz">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="wortschatz">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

    </div>
  </section>

  <!-- GAME -->
  <section id="screen-game" class="glass card hidden" style="margin-top:18px">
    <div class="row">
      <div id="hudCatName" class="pill"></div>
      <div class="pill">‚è±Ô∏è <span id="hudTimer"></span></div>
      <div class="pill" id="hudCounter"></div>
      <div class="pill" id="hudScore"></div>
    </div>
    <div class="bar"><div id="hudProgress" class="fill" style="width:0"></div></div>
    <div id="qText" class="q"></div>
    <div id="opts"></div>
    <div id="explain" class="muted"></div>
    <div class="row">
      <button id="btnReveal" class="btn ghost">Reveal</button>
      <button id="btnNext" class="btn">Next ‚ñ∂</button>
    </div>
  </section>

  <!-- ADMIN -->
  <details id="adminPanel" class="glass card" style="display:none;margin-top:18px">
    <summary>Admin: Import / Export</summary>
    <div class="grid" style="gap:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));align-items:end">
      <label>Category<br/>
        <select id="impCat">
          <option value="india">Incredible India</option>
          <option value="geography">Geography</option>
          <option value="science">Science</option>
          <option value="history">History</option>
          <option value="arts">Arts &amp; Culture</option>
          <option value="tolkien">Tolkien &amp; Middle-earth</option>
          <option value="wortschatz">Wortschatz (B2)</option>
        </select>
      </label>
      <label>File<br/>
        <input id="impFile" type="file" accept=".json,.csv"/>
      </label>
      <button class="btn" id="btnImport">Import</button>
      <button class="btn" id="btnExportCat">Export Cat</button>
      <button class="btn ghost" id="btnImportAll">Import ALL</button>
      <button class="btn ghost" id="btnExportAll">Export ALL</button>
      <button class="btn ghost" id="btnClearLocal">Clear Local</button>
      <button class="btn ghost" id="btnOneFile">One-File Backup</button>
    </div>
    <div id="impMsg" class="muted" style="margin-top:8px"></div>
  </details>

<!-- Embedded BANK payload for one-file backups (replaced on backup) -->
<script id="embeddedBank" type="application/json">{
  "india": [],
  "geography": [],
  "science": [],
  "history": [],
  "arts": [],
  "tolkien": [],
  "wortschatz": []
}</script>

<script>
/* ---------- Seed minimal data so it runs immediately. Replace via Import ---------- */
let BANK = {
  india: [
    {question:"Which Indian mathematician's work on infinite series prefigured calculus?",options:["Aryabhata","Bhaskara II","Madhava of Sangamagrama","Ramanujan"],correct:2,explanation:"Madhava's 14th‚Äëcentury Kerala school derived power series centuries before Newton.",difficulty:"Masters"}
  ],
  geography: [
    {question:"Atlantic thermohaline circulation is primarily driven by?",options:["Temperature gradients","Salinity and density differences","Wind shear","Lunar tides"],correct:1,explanation:"Deep water formation near Greenland arises from salty, cold, dense water sinking.",difficulty:"Masters"}
  ],
  science: [
    {question:"The Higgs mechanism endows particles with mass via interaction with the?",options:["Gauge bosons","Higgs field","Dark matter","Gravitational waves"],correct:1,explanation:"Spontaneous symmetry breaking in the Higgs field gives W and Z bosons mass.",difficulty:"Masters"}
  ],
  history: [
    {question:"The Treaty of Westphalia in 1648 ended which conflict?",options:["Thirty Years' War","Hundred Years' War","War of the Roses","English Civil War"],correct:0,explanation:"The Treaty of Westphalia concluded the Thirty Years' War, shaping modern state sovereignty.",difficulty:"Masters"}
  ],
  arts: [
    {question:"Which art movement is characterized by small, thin brush strokes and open composition?",options:["Impressionism","Cubism","Baroque","Surrealism"],correct:0,explanation:"Impressionism captures light and movement with loose brushwork and vivid colors.",difficulty:"Masters"}
  ],
  tolkien: [
    {question:"Who forged the One Ring?",options:["Sauron","Celebrimbor","Saruman","Melkor"],correct:0,explanation:"Sauron created the Ruling Ring in the fires of Mount Doom to dominate the other Rings of Power.",difficulty:"Masters"}
  ],
  wortschatz: [
    {question:"Deutsch ‚Üí Englisch: 'veranschaulichen'",options:["to exemplify","to legislate","to retreat","to harvest"],correct:0,explanation:"'Veranschaulichen' means to illustrate or exemplify an idea.",difficulty:"B2"}
  ]
};

/* ---------- Merge embedded payload (one-file backups) ---------- */
(function mergeEmbedded(){
  try{
    const raw = document.getElementById('embeddedBank')?.textContent || '{}';
    const obj = JSON.parse(raw);
    if (obj && typeof obj==='object'){
      for (const k of Object.keys(obj)){
        if (Array.isArray(obj[k]) && obj[k].length) BANK[k] = obj[k];
      }
    }
  }catch{}
})();

/* ---------- Local overrides (browser) ---------- */
(function loadLocal(){
  try{
    const x = JSON.parse(localStorage.getItem('BANK_LOCAL')||'null');
    if (x && typeof x==='object'){
      for (const k of Object.keys(x)) if (Array.isArray(x[k])) BANK[k]=x[k];
    }
  }catch{}
})();

/* ---------- UI helpers ---------- */
const $  = s => document.querySelector(s);
const $$ = s => [...document.querySelectorAll(s)];
function show(id){ ["#screen-home","#screen-game"].forEach(s=>$(s).classList.add("hidden")); $(id).classList.remove("hidden"); }
function updateHomeCounts(){ for (const k of Object.keys(BANK)){ const n = BANK[k]?.length||0; const el = document.querySelector(`[data-count="${k}"]`); if (el) el.textContent = n; } }
updateHomeCounts();
if (new URLSearchParams(location.search).get('admin') === '1') { const p = document.getElementById('adminPanel'); if (p) p.style.display = ''; }

/* ---------- Game logic ---------- */
const ROUND_COUNT = 10;
const PER_Q = 45;
let state = {cat:null, deck:[], idx:0, score:0, t:PER_Q, id:null, answered:false};

function shuffle(a){ for (let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function pickN(arr,n){ const copy=[...(arr||[])]; shuffle(copy); return copy.slice(0, Math.min(n, copy.length)); }

function startGame(cat){
  const deck = pickN(BANK[cat]||[], ROUND_COUNT);
  if (!deck.length){ alert("No questions in this category yet."); return; }
  state = {cat, deck, idx:0, score:0, t:PER_Q, id:null, answered:false};
  $("#btnHome").classList.remove("hidden");
  show("#screen-game"); renderQ(); startTimer();
}
function renderQ(){
  const q = state.deck[state.idx];
  $("#hudCatName").textContent = state.cat;
  $("#hudCounter").textContent = `Q ${state.idx+1} / ${state.deck.length}`;
  $("#hudScore").textContent   = `Score: ${state.score}/${state.deck.length}`;
  $("#hudProgress").style.width = `${(state.idx/state.deck.length)*100}%`;
  $("#hudTimer").textContent   = `${state.t}s`;
  $("#qText").textContent      = q.question;
  $("#explain").textContent    = "";
  const wrap = $("#opts"); wrap.innerHTML = "";
  q.options.forEach((opt,i)=>{
    const d = document.createElement("div");
    d.className="opt"; d.textContent=opt; d.onclick = ()=> choose(i);
    wrap.appendChild(d);
  });
}
function choose(i){
  if (state.answered) return; state.answered = true;
  const q = state.deck[state.idx]; const nodes = [...$("#opts").children];
  nodes.forEach((n,idx)=>{ if (idx===q.correct) n.classList.add("correct"); if (idx===i && i!==q.correct) n.classList.add("wrong"); });
  if (i===q.correct) state.score++;
  $("#explain").textContent = q.explanation||"";
}
function startTimer(){
  clearInterval(state.id); state.t = PER_Q;
  state.id = setInterval(()=>{ state.t--; $("#hudTimer").textContent = `${state.t}s`; if (state.t<=0){ state.answered=true; next(); } },1000);
}
function next(){
  if (state.idx < state.deck.length-1){
    state.idx++; state.answered=false; state.t=PER_Q; renderQ(); startTimer();
  }else{
    clearInterval(state.id);
    alert(`Finished! Score ${state.score}/${state.deck.length}`);
    $("#btnHome").classList.add("hidden"); show("#screen-home");
  }
}

/* Buttons */
$$('[data-start]').forEach(b=> b.onclick = ()=> startGame(b.getAttribute('data-start')));
$("#btnHome").onclick = ()=>{ clearInterval(state.id); $("#btnHome").classList.add("hidden"); show("#screen-home"); };
$("#btnNext").onclick  = next;
$("#btnReveal").onclick= ()=>{ if (!state.answered){ choose(state.deck[state.idx].correct); } };

/* ---------- Admin: import/export, one-file backup (LOCAL ONLY) ---------- */
function csvToObjects(text){
  const lines = text.replace(/\r/g,'').split('\n').filter(Boolean);
  if (!lines.length) return [];
  const head = lines.shift().split(',').map(s=>s.trim());
  return lines.map(row=>{
    const cols = row.split(',').map(s=>s.trim()); const obj = {};
    head.forEach((h,i)=>obj[h]=cols[i] ?? '');
    return {
      question: obj.question,
      options: [obj.optionA, obj.optionB, obj.optionC, obj.optionD],
      correct: Number(obj.correct||0),
      explanation: obj.explanation||'',
      difficulty: obj.difficulty||'Masters',
      category: obj.category||''
    };
  });
}
function validateQ(q){
  return q && typeof q.question==='string' && q.question.trim()
      && Array.isArray(q.options) && q.options.length===4
      && [0,1,2,3].includes(q.correct);
}
function dedupeMerge(targetArr, incoming){
  const seen = new Set(targetArr.map(x=>x.question.trim().toLowerCase()));
  let add=0, skip=0, bad=0;
  for (const q of incoming){
    if (!validateQ(q)) { bad++; continue; }
    const key = q.question.trim().toLowerCase();
    if (seen.has(key)) { skip++; continue; }
    targetArr.push(q); seen.add(key); add++;
  }
  return {add,skip,bad};
}
function saveLocal(){ try{ localStorage.setItem('BANK_LOCAL', JSON.stringify(BANK)); }catch{} }
function download(name, text, type='application/json'){
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([text],{type})); a.download = name; a.click(); URL.revokeObjectURL(a.href);
}
const elCat=$("#impCat"), elFile=$("#impFile"), msg=$("#impMsg");

$("#btnImport")?.addEventListener('click', async ()=>{
  const cat = elCat.value; const f = elFile.files[0];
  if (!f){ msg.textContent='Choose a .json or .csv file.'; return; }
  const txt = await f.text(); let arr = [];
  try{ arr = f.name.toLowerCase().endsWith('.csv') ? csvToObjects(txt) : JSON.parse(txt); }
  catch(e){ msg.textContent='Parse error: '+e.message; return; }
  if (!Array.isArray(arr)){ msg.textContent='File must be an array of questions.'; return; }
  BANK[cat] = BANK[cat]||[]; const res = dedupeMerge(BANK[cat], arr);
  saveLocal(); updateHomeCounts();
  msg.textContent = `Imported into "${cat}": +${res.add} added, ${res.skip} duplicates, ${res.bad} invalid. Total ${BANK[cat].length}.`;
});

$("#btnImportAll")?.addEventListener('click', async ()=>{
  const f = elFile.files[0]; if (!f){ msg.textContent='Choose an ALL JSON first.'; return; }
  try{
    const obj = JSON.parse(await f.text());
    if (!obj || typeof obj!=='object') throw new Error('Not an object');
    for (const k of Object.keys(obj)) if (Array.isArray(obj[k])) BANK[k]=obj[k];
    saveLocal(); updateHomeCounts(); msg.textContent='Imported ALL categories.';
  }catch(e){ msg.textContent='Parse error: '+e.message; }
});

$("#btnExportCat")?.addEventListener('click', ()=>{
  const cat = elCat.value; download(`${cat}.json`, JSON.stringify(BANK[cat]||[], null, 2));
});
$("#btnExportAll")?.addEventListener('click', ()=>{
  download(`all_categories.json`, JSON.stringify(BANK, null, 2));
});
$("#btnClearLocal")?.addEventListener('click', ()=>{
  localStorage.removeItem('BANK_LOCAL'); msg.textContent='Local overrides cleared. Reload to use embedded data.';
});
$("#btnOneFile")?.addEventListener('click', ()=>{
  try{
    const doc = document.cloneNode(true);
    const el = doc.getElementById('embeddedBank'); if (el) el.textContent = JSON.stringify(BANK, null, 2);
    const html = '<!DOCTYPE html>\n' + doc.documentElement.outerHTML;
    download('triviaquest_onefile_backup.html', html, 'text/html');
    msg.textContent='One-file backup downloaded.';
  }catch(e){ msg.textContent='Backup failed: '+e.message; }
});
</script>
</div>
</body>
</html>
