<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TriviaQuest ‚Äì Single File</title>
<style>
  :root{
    --bg:#0b1220;--panel:#0f172a;--panel2:#1e293b;--border:#334155;--text:#e5e7eb;
    --muted:#94a3b8;--accent:#3b82f6;--emerald:#22c55e;--warn:#facc15;--danger:#ef4444;
  }
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto,Inter,Arial}
  .wrap{max-width:1100px;margin:0 auto;padding:24px}
  .glass{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.04));border:1px solid #ffffff1a}
  h1{font-size:clamp(26px,3.6vw,40px);margin:0 0 8px}
  .sub{color:var(--muted);margin:0 0 20px}
  .grid{display:grid;gap:16px}
  @media(min-width:800px){.grid.cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}}
  .card{border-radius:16px;padding:16px}
  .row{display:flex;align-items:center;justify-content:space-between}
  .btn{display:inline-flex;align-items:center;justify-content:center;border-radius:12px;border:1px solid #ffffff22;padding:10px 14px;cursor:pointer;background:#ffffff0f;color:#fff;text-decoration:none}
  .btn:hover{background:#ffffff1f}
  .big{padding:12px 16px;border-radius:14px}
  .hidden{display:none}
  .pill{font-size:12px;padding:3px 8px;border-radius:999px;border:1px solid #ffffff22;background:#ffffff14}
  .bar{height:8px;border-radius:999px;background:#ffffff14;overflow:hidden}
  .fill{height:100%;background:linear-gradient(90deg,#22c55e,#3b82f6)}
  input,select,textarea{background:#fff;color:#111;border-radius:10px;border:none;padding:8px 10px}
  table{width:100%;border-collapse:collapse} td{padding:6px 0}
  .q{font-weight:700;font-size:18px;margin-bottom:12px}
  .opt{border:1px solid #ffffff22;border-radius:12px;padding:10px 12px;margin:8px 0;cursor:pointer;background:#ffffff07}
  .opt.correct{border-color:#22c55e;background:#22c55e22}
  .opt.wrong{border-color:#ef4444;background:#ef444422}
  .muted{color:#9fb0c7}
  .foot{opacity:.8;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <header class="glass card" style="display:flex;align-items:center;gap:16px">
    <div class="pill">Ready</div>
    <div>
      <h1>TriviaQuest</h1>
      <p class="sub">One-file quiz. Import, play, export ‚Äì no server needed.</p>
    </div>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <button id="btnHome" class="btn hidden">üè† Home</button>
    </div>
  </header>

  <!-- HOME -->
  <section id="screen-home" class="glass card" style="margin-top:16px">
    <div class="grid cols-4">
      <!-- category cards -->
      <div class="card glass">
        <div class="row"><div>üáÆüá≥ Incredible India</div><span class="pill"><span data-count="india">0</span> Qs</span></div>
        <button class="btn big" data-start="india">Start Challenge</button>
      </div>
      <div class="card glass">
        <div class="row"><div>üåç Geography</div><span class="pill"><span data-count="geography">0</span> Qs</span></div>
        <button class="btn big" data-start="geography">Start Challenge</button>
      </div>
      <div class="card glass">
        <div class="row"><div>üß™ Science</div><span class="pill"><span data-count="science">0</span> Qs</span></div>
        <button class="btn big" data-start="science">Start Challenge</button>
      </div>
      <div class="card glass">
        <div class="row"><div>üìú History</div><span class="pill"><span data-count="history">0</span> Qs</span></div>
        <button class="btn big" data-start="history">Start Challenge</button>
      </div>
      <div class="card glass">
        <div class="row"><div>üé≠ Arts</div><span class="pill"><span data-count="arts">0</span> Qs</span></div>
        <button class="btn big" data-start="arts">Start Challenge</button>
      </div>
      <div class="card glass">
        <div class="row"><div>üßô Tolkien</div><span class="pill"><span data-count="tolkien">0</span> Qs</span></div>
        <button class="btn big" data-start="tolkien">Start Challenge</button>
      </div>
      <div class="card glass">
        <div class="row"><div>üèõÔ∏è PolSci</div><span class="pill"><span data-count="polsci">0</span> Qs</span></div>
        <button class="btn big" data-start="polsci">Start Challenge</button>
      </div>
      <div class="card glass">
        <div class="row"><div>üß¨ Biology</div><span class="pill"><span data-count="biology">0</span> Qs</span></div>
        <button class="btn big" data-start="biology">Start Challenge</button>
      </div>
    </div>
  </section>

  <!-- GAME -->
  <section id="screen-game" class="glass card hidden" style="margin-top:16px">
    <div class="row" style="gap:12px;align-items:flex-end">
      <div style="font-weight:700" id="hudCatName">Category</div>
      <div class="pill" id="hudCounter">1/10</div>
      <div class="pill" id="hudTimer">45s</div>
      <div style="margin-left:auto" id="hudScore">Score: 0/10</div>
    </div>
    <div class="bar" style="margin:12px 0 16px"><div id="hudProgress" class="fill" style="width:0%"></div></div>
    <div id="qWrap">
      <div class="q" id="qText">Question</div>
      <div id="opts"></div>
      <p class="muted" id="explain"></p>
      <div class="row" style="margin-top:12px">
        <button id="btnNext" class="btn big">Next</button>
      </div>
    </div>
  </section>

  <!-- ADMIN -->
  <section class="glass card" style="margin-top:16px">
    <details open>
      <summary class="cursor-pointer" style="font-weight:700">Admin: Import / Export</summary>
      <div style="margin-top:12px" class="grid" >
        <div class="grid" style="grid-template-columns:1fr 1fr 1fr;gap:12px">
          <div>
            <label>Category</label><br/>
            <select id="impCat">
              <option value="india">india</option>
              <option value="geography">geography</option>
              <option value="science">science</option>
              <option value="history">history</option>
              <option value="arts">arts</option>
              <option value="tolkien">tolkien</option>
              <option value="polsci">polsci</option>
              <option value="biology">biology</option>
            </select>
          </div>
          <div>
            <label>Upload JSON/CSV</label><br/>
            <input id="impFile" type="file" accept=".json,.csv" />
          </div>
          <div style="display:flex;align-items:end;gap:8px">
            <button id="btnImport" class="btn">Import (to category)</button>
          </div>
        </div>

        <div style="display:flex;flex-wrap:wrap;gap:8px">
          <button id="btnImportAll" class="btn">Import ALL (JSON)</button>
          <button id="btnExportCat" class="btn">Export selected (JSON)</button>
          <button id="btnExportAll" class="btn">Export ALL (JSON)</button>
          <button id="btnOneFile" class="btn">Download One-File Backup (.html)</button>
          <button id="btnClearLocal" class="btn">Clear local overrides</button>
        </div>
        <p id="impMsg" class="muted"></p>
      </div>
      <p class="foot">CSV header: <code>question,optionA,optionB,optionC,optionD,correct,explanation,difficulty,category</code> (correct = 0..3)</p>
    </details>
  </section>

  <footer class="wrap" style="padding:8px 0">
    <p class="foot">Tip: work in chunks (e.g., 50 Qs), Import ‚Üí test ‚Üí Export ALL ‚Üí commit.</p>
  </footer>
</div>

<!-- Embedded BANK payload (this gets filled by "one-file backup") -->
<script id="embeddedBank" type="application/json">{
  "india": [],
  "geography": [],
  "science": [],
  "history": [],
  "arts": [],
  "tolkien": [],
  "polsci": [],
  "biology": []
}</script>

<script>
/*** Minimal sample data so it runs out of the box. Replace via Admin import. ***/
let BANK = {
  india: [
    {question:"Where does the southwest monsoon first hit India?",options:["Kolkata","Thiruvananthapuram","Mumbai","Chennai"],correct:1,explanation:"Onset typically reaches Kerala first in early June.",difficulty:"Masters",category:"Geography"},
    {question:"The Deccan Traps formed primarily due to:",options:["Subduction","Hotspot flood basalts","Mid-ocean ridge","Asteroid impacts only"],correct:1,explanation:"Long-lived R√©union hotspot volcanism produced vast flood basalts.",difficulty:"Masters",category:"Geology"}
  ],
  geography: [
    {question:"Coriolis effect is:",options:["Friction with continents","Apparent deflection due to Earth's rotation","Magnetic bending of winds","Gravity on plates"],correct:1,explanation:"Motion deflects right NH / left SH in a rotating frame.",difficulty:"Masters",category:"Atmosphere"}
  ],
  science: [
    {question:"Chandrasekhar limit (~1.44 M‚òâ) applies to:",options:["Neutron stars","White dwarfs","Black holes","Brown dwarfs"],correct:1,explanation:"Above that mass, electron degeneracy can‚Äôt support a white dwarf.",difficulty:"Masters",category:"Astrophysics"}
  ],
  history: [
    {question:"Treaty of Westphalia (1648) cemented:",options:["Balance of power","State sovereignty","Collective security","Free trade"],correct:1,explanation:"Modern sovereign state system and non-interference.",difficulty:"Masters",category:"Early Modern"}
  ],
  arts: [
    {question:"Auteur theory regards the ____ as the film‚Äôs author.",options:["Screenwriter","Director","Producer","Editor"],correct:1,explanation:"Directorial visual decisions imprint authorship.",difficulty:"Masters",category:"Film"}
  ],
  tolkien: [
    {question:"Gandalf is one of the:",options:["Valar","Maiar (Istari)","Eldar","N√∫men√≥reans"],correct:1,explanation:"Ol√≥rin the Maia, sent as an Istar.",difficulty:"Advanced",category:"LotR"}
  ],
  polsci: [
    {question:"Constructivism emphasises:",options:["Material power only","Socially constructed identities & norms","Geography only","Biology"],correct:1,explanation:"Inter-subjective norms/identities shape interests.",difficulty:"Masters",category:"IR Theory"}
  ],
  biology: [
    {question:"Chloroplasts descend from:",options:["Archaea","Cyanobacteria","Alpha-proteobacteria","Fungi"],correct:1,explanation:"Primary endosymbiosis of a cyanobacterium.",difficulty:"Masters",category:"Cell Biology"}
  ],
};
/*** Load embedded payload (if any) and local overrides ***/
(function mergeEmbedded(){
  try{
    const raw = document.getElementById('embeddedBank')?.textContent || '{}';
    const obj = JSON.parse(raw);
    if (obj && typeof obj==='object'){
      for (const k of Object.keys(obj)){
        if (Array.isArray(obj[k]) && obj[k].length) BANK[k] = obj[k];
      }
    }
  }catch{}
})();
(function loadLocal(){
  try{
    const x = JSON.parse(localStorage.getItem('BANK_LOCAL')||'null');
    if (x && typeof x==='object'){
      for (const k of Object.keys(x)) if (Array.isArray(x[k])) BANK[k]=x[k];
    }
  }catch{}
})();

/*** UI helpers ***/
const $ = sel => document.querySelector(sel);
const $$ = sel => [...document.querySelectorAll(sel)];
function updateHomeCounts(){
  for (const k of Object.keys(BANK)){
    const n = BANK[k]?.length||0;
    const el = document.querySelector(`[data-count="${k}"]`);
    if (el) el.textContent = n;
  }
}
updateHomeCounts();

/*** Game ***/
const ROUND_COUNT = 10;
const PER_QUESTION_SECONDS = 45;
let state = {cat:null, deck:[], idx:0, score:0, timer:PER_QUESTION_SECONDS, id:null, answered:false, selected:null};

function pickN(arr,n){ return arr.slice(0, Math.min(n, arr.length)); }
function show(id){ ["#screen-home","#screen-game"].forEach(s=>$(s).classList.add("hidden")); $(id).classList.remove("hidden"); }
function goHome(){ clearInterval(state.id); $("#btnHome").classList.add("hidden"); show("#screen-home"); }
$("#btnHome").onclick = goHome;

$$('[data-start]').forEach(btn=>{
  btn.onclick = ()=>{
    const cat = btn.getAttribute('data-start');
    startGame(cat);
  };
});

function startGame(cat){
  state = {cat, deck:pickN(BANK[cat]||[], ROUND_COUNT), idx:0, score:0, timer:PER_QUESTION_SECONDS, id:null, answered:false, selected:null};
  if (!state.deck.length){ alert("No questions in this category yet."); return; }
  $("#btnHome").classList.remove("hidden");
  show("#screen-game");
  renderQuestion();
  startTimer();
}

function renderQuestion(){
  const q = state.deck[state.idx];
  $("#hudCatName").textContent = state.cat;
  $("#hudCounter").textContent = `Q ${state.idx+1} / ${state.deck.length}`;
  $("#hudScore").textContent = `Score: ${state.score}/${state.deck.length}`;
  $("#hudProgress").style.width = `${(state.idx/state.deck.length)*100}%`;
  $("#hudTimer").textContent = `${state.timer}s`;
  $("#qText").textContent = q.question;
  $("#explain").textContent = "";
  const wrap = $("#opts"); wrap.innerHTML = "";
  q.options.forEach((opt,i)=>{
    const d = document.createElement("div");
    d.className = "opt";
    d.textContent = opt;
    d.onclick = ()=> chooseOption(i);
    wrap.appendChild(d);
  });
  $("#btnNext").onclick = nextQuestion;
}

function chooseOption(i){
  if (state.answered) return;
  state.answered = true; state.selected = i;
  const q = state.deck[state.idx];
  const nodes = [...$("#opts").children];
  nodes.forEach((n,idx)=>{
    if (idx===q.correct) n.classList.add("correct");
    if (idx===i && i!==q.correct) n.classList.add("wrong");
  });
  if (i===q.correct) state.score++;
  $("#explain").textContent = q.explanation||"";
}

function startTimer(){
  clearInterval(state.id);
  state.timer = PER_QUESTION_SECONDS;
  state.id = setInterval(()=>{
    state.timer--;
    $("#hudTimer").textContent = `${state.timer}s`;
    if (state.timer<=0){ state.answered=true; nextQuestion(); }
  },1000);
}

function nextQuestion(){
  if (state.idx < state.deck.length-1){
    state.idx++; state.answered=false; state.selected=null;
    renderQuestion(); startTimer();
  }else{
    alert(`Done! Score ${state.score}/${state.deck.length}`);
    goHome();
  }
}

/*** Admin: import/export (single-file friendly) ***/
function csvToObjects(text){
  const lines = text.replace(/\r/g,'').split('\n').filter(Boolean);
  if (!lines.length) return [];
  const head = lines.shift().split(',').map(s=>s.trim());
  return lines.map(row=>{
    const cols = row.split(',').map(s=>s.trim());
    const obj = {}; head.forEach((h,i)=>obj[h]=cols[i] ?? '');
    return {
      question: obj.question,
      options: [obj.optionA, obj.optionB, obj.optionC, obj.optionD],
      correct: Number(obj.correct||0),
      explanation: obj.explanation||'',
      difficulty: obj.difficulty||'Masters',
      category: obj.category||''
    };
  });
}
function validateQ(q){
  if (!q || typeof q.question!=='string' || !q.question.trim()) return false;
  if (!Array.isArray(q.options) || q.options.length!==4) return false;
  if (![0,1,2,3].includes(q.correct)) return false;
  return true;
}
function dedupeMerge(targetArr, incoming){
  const seen = new Set(targetArr.map(x=>x.question.trim().toLowerCase()));
  let add=0, skip=0, bad=0;
  for (const q of incoming){
    if (!validateQ(q)) { bad++; continue; }
    const key = q.question.trim().toLowerCase();
    if (seen.has(key)) { skip++; continue; }
    targetArr.push(q); seen.add(key); add++;
  }
  return {add,skip,bad};
}
function saveLocal(){
  try{ localStorage.setItem('BANK_LOCAL', JSON.stringify(BANK)); }catch{}
}
function download(name, text, type='application/json'){
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([text],{type}));
  a.download = name; a.click(); URL.revokeObjectURL(a.href);
}

const elCat  = $("#impCat");
const elFile = $("#impFile");
const msg    = $("#impMsg");

$("#btnImport").onclick = async ()=>{
  const cat = elCat.value;
  const f = elFile.files[0];
  if (!f){ msg.textContent='Choose a .json or .csv file.'; return; }
  const text = await f.text();
  let arr = [];
  try{
    arr = f.name.toLowerCase().endsWith('.csv') ? csvToObjects(text) : JSON.parse(text);
  }catch(e){ msg.textContent='Parse error: '+e.message; return; }
  if (!Array.isArray(arr)){ msg.textContent='File must be an array of questions.'; return; }
  BANK[cat] = BANK[cat]||[];
  const res = dedupeMerge(BANK[cat], arr);
  saveLocal(); updateHomeCounts();
  msg.textContent = `Imported into "${cat}": +${res.add} added, ${res.skip} duplicates, ${res.bad} invalid. Total ${BANK[cat].length}.`;
};

$("#btnImportAll").onclick = async ()=>{
  const f = elFile.files[0];
  if (!f){ msg.textContent='Choose ALL JSON first (exported previously).'; return; }
  try{
    const obj = JSON.parse(await f.text());
    if (!obj || typeof obj!=='object') throw new Error('Not an object');
    for (const k of Object.keys(obj)) if (Array.isArray(obj[k])) BANK[k]=obj[k];
    saveLocal(); updateHomeCounts();
    msg.textContent = 'Imported ALL categories.';
  }catch(e){ msg.textContent='Parse error: '+e.message; }
};

$("#btnExportCat").onclick = ()=>{
  const cat = elCat.value;
  download(`${cat}.json`, JSON.stringify(BANK[cat]||[], null, 2));
};
$("#btnExportAll").onclick = ()=>{
  download(`all_categories.json`, JSON.stringify(BANK, null, 2));
};
$("#btnClearLocal").onclick = ()=>{
  localStorage.removeItem('BANK_LOCAL');
  msg.textContent = 'Local overrides cleared. Reload to use built-in/embedded data.';
};

/* One-file backup: clones this HTML and embeds current BANK into #embeddedBank */
$("#btnOneFile").onclick = ()=>{
  try{
    const doc = document.cloneNode(true);
    const el = doc.getElementById('embeddedBank');
    if (el) el.textContent = JSON.stringify(BANK, null, 2);
    const html = '<!DOCTYPE html>\n' + doc.documentElement.outerHTML;
    download('triviaquest_onefile_backup.html', html, 'text/html');
    msg.textContent = 'One-file backup downloaded.';
  }catch(e){
    msg.textContent = 'Backup failed: '+e.message;
  }
};

/*** End admin ***/
</script>
</body>
</html>
