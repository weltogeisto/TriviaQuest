<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>TriviaQuest ‚Äî Masters Level Edition</title>
<style>
  :root{
    --bg1:#1a1040; --bg2:#2a0f5a;
    --glass: rgba(255,255,255,.06);
    --border: #ffffff1a;
    --text:#e9eef6; --muted:#a9b7d0;
    --accent:#7dd3fc; --ok:#22c55e; --warn:#facc15; --danger:#ef4444;
    --card-shadow: 0 10px 30px rgba(0,0,0,.25);
  }
  *{box-sizing:border-box}
  html,body{
    margin:0;
    background:radial-gradient(1200px 800px at 20% -10%,#4c1d95 0,#2a0f5a 50%,#120a2b 100%);
    color:var(--text);
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial
  }
  .wrap{max-width:1120px;margin:0 auto;padding:28px 20px 60px}
  .glass{background:linear-gradient(180deg,var(--glass),transparent);border:1px solid var(--border);backdrop-filter:blur(6px)}
  .card{border-radius:18px;padding:18px;box-shadow:var(--card-shadow)}
  h1{margin:0 0 8px;font-size:clamp(26px,3.5vw,40px);letter-spacing:.2px}
  .sub{margin:0;color:var(--muted)}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;border:1px solid var(--border);background:#ffffff14;font-size:12px}
  .meta{display:inline-flex;gap:8px;align-items:center}
  .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#ffffff12;color:#fff;cursor:pointer;text-decoration:none;font-weight:600}
  .btn:hover{background:#ffffff22}
  .ghost{background:#ffffff0a}
  .big{padding:12px 16px;border-radius:14px}
  .hidden{display:none}
  .grid{display:grid;gap:16px}
  @media(min-width:860px){.grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}

  /* category cards */
  .cat{position:relative;overflow:hidden}
  .cat h3{margin:2px 0 4px;font-size:20px}
  .cat p{margin:0 0 8px;color:var(--muted);font-size:14px}
  .tag{position:absolute;top:14px;right:14px;font-size:12px}
  .badge{position:absolute;left:14px;top:14px;font-size:12px;background:#00000040}
  .chip{display:inline-flex;align-items:center;gap:6px;font-size:12px;padding:3px 8px;border-radius:999px;border:1px solid var(--border);background:#ffffff12}
  .start{margin-top:8px}
  .c_orange{background:linear-gradient(160deg,#ff7a18 0,#ffb44c 100%)}
  .c_green{background:linear-gradient(160deg,#10b981 0,#22d3ee 100%)}
  .c_blue{background:linear-gradient(160deg,#2563eb 0,#7c3aed 100%)}
  .c_purple{background:linear-gradient(160deg,#a855f7 0,#ec4899 100%)}
  .c_teal{background:linear-gradient(160deg,#06b6d4 0,#34d399 100%)}
  .c_emerald{background:linear-gradient(160deg,#059669 0,#22c55e 100%)}
  .c_rose{background:linear-gradient(160deg,#f43f5e 0,#fb7185 100%)}
  .cat .overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.28),rgba(0,0,0,.32))}
  .cat .content{position:relative}

  /* game */
  .bar{height:8px;border-radius:999px;background:#ffffff14;overflow:hidden;margin:10px 0 16px}
  .fill{height:100%;background:linear-gradient(90deg,#22c55e,#3b82f6)}
  .q{font-size:20px;font-weight:700;margin:6px 0 12px}
  .opt{border:1px solid var(--border);background:#ffffff0e;border-radius:14px;padding:12px;margin:10px 0;cursor:pointer}
  .opt:hover{background:#ffffff1b}
  .opt.correct{border-color:#22c55e;background:#22c55e22}
  .opt.wrong{border-color:#ef4444;background:#ef444422}
  .muted{color:var(--muted)}
  .foot{opacity:.8;font-size:12px}
  details>summary{cursor:pointer}
  select,input{background:#fff;color:#111;border-radius:10px;border:none;padding:8px 10px}
  code{background:#00000033;padding:1px 6px;border-radius:6px}
</style>
</head>
<body>
<div class="wrap">

  <!-- Header -->
  <header class="glass card" style="display:flex;gap:16px;align-items:center">
    <div class="pill">üß† Ready</div>
    <div>
      <h1>TriviaQuest</h1>
      <p class="sub">Advanced academic trivia for graduate students</p>
      <div class="meta" style="margin-top:6px">
        <span class="pill">‚è±Ô∏è 45s / question</span>
        <span class="pill">üîÅ 10 per round</span>
        <span class="pill">üß™ Masters-level</span>
      </div>
    </div>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <button id="btnHome" class="btn hidden">üè† Home</button>
    </div>
  </header>

  <!-- HOME -->
  <section id="screen-home" class="glass card" style="margin-top:18px">
    <div class="grid cols-3">

      <div class="cat card c_orange">
        <div class="overlay"></div>
        <div class="content">
          <span class="badge pill">‚≠ê META</span>
          <span class="tag pill">45s</span>
          <h3>Incredible India</h3>
          <p>Masters-level India across disciplines</p>
          <div class="chip">üì¶ <span data-count="india">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="india">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_green">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>Geography</h3>
          <p>Advanced physical & human geography</p>
          <div class="chip">üì¶ <span data-count="geography">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="geography">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_blue">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>Science</h3>
          <p>Physics, biology, chemistry & more</p>
          <div class="chip">üì¶ <span data-count="science">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="science">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_purple">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>History</h3>
          <p>Global historical events and figures</p>
          <div class="chip">üì¶ <span data-count="history">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="history">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_teal">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>Arts & Culture</h3>
          <p>Visual arts, music, and literature</p>
          <div class="chip">üì¶ <span data-count="arts">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="arts">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_emerald">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>Tolkien & Middle-earth</h3>
          <p>Lore from The Lord of the Rings</p>
          <div class="chip">üì¶ <span data-count="tolkien">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="tolkien">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

      <div class="cat card c_rose">
        <div class="overlay"></div>
        <div class="content">
          <span class="tag pill">45s</span>
          <h3>Wortschatz (B2)</h3>
          <p>German vocabulary practice</p>
          <div class="chip">üì¶ <span data-count="wortschatz">0</span> questions</div>
          <div class="start"><button class="btn big" data-start="wortschatz">‚ñ∂ Start Challenge</button></div>
        </div>
      </div>

    </div>
  </section>

  <!-- GAME -->
  <section id="screen-game" class="glass card hidden" style="margin-top:18px">
    <div class="row">
      <div id="hudCatName" class="pill"></div>
      <div class="pill">‚è±Ô∏è <span id="hudTimer"></span></div>
      <div class="pill" id="hudCounter"></div>
      <div class="pill" id="hudScore"></div>
    </div>
    <div class="bar"><div id="hudProgress" class="fill" style="width:0"></div></div>
    <div id="qText" class="q"></div>
    <div id="opts"></div>
    <div id="explain" class="muted"></div>
    <div class="row">
      <button id="btnReveal" class="btn ghost">Reveal</button>
      <button id="btnNext" class="btn">Next ‚ñ∂</button>
    </div>
  </section>

  <!-- Admin panel omitted for brevity (same as repository) -->

<!-- Embedded BANK payload for one-file backups (replaced on backup) -->
<script id="embeddedBank" type="application/json">{
  "india": [],
  "geography": [],
  "science": [],
  "history": [],
  "arts": [],
  "tolkien": [],
  "wortschatz": []
}</script>

<script>
/* ---------- Seed minimal data so it runs immediately. Replace via Import ---------- */
let BANK = {
  india: [
    {question:"Which Indian mathematician's work on infinite series prefigured calculus?",options:["Aryabhata","Bhaskara II","Madhava of Sangamagrama","Ramanujan"],correct:2,explanation:"Madhava's 14th‚Äëcentury Kerala school derived power series centuries before Newton.",difficulty:"Masters"},
    {question:"The 'Chipko movement' is associated with which region?",options:["Aravalli","Western Ghats","Himalayas","Deccan Plateau"],correct:2,explanation:"Villagers in Garhwal, Himalayas, hugged trees to prevent logging in the 1970s.",difficulty:"Masters"},
    {question:"Which Mughal emperor commissioned a Persian translation of the Mahabharata?",options:["Akbar","Aurangzeb","Shah Jahan","Jahangir"],correct:0,explanation:"Akbar's court scholars produced the \"Razmnama\" to foster interreligious dialogue.",difficulty:"Masters"},
    {question:"India's research station 'Bharati' operates on which continent?",options:["Asia","Antarctica","Europe","Africa"],correct:1,explanation:"Bharati, opened in 2012, supports India's polar science program in Antarctica.",difficulty:"Masters"},
    {question:"In Hindustani classical music, raga Bhairav is traditionally performed at?",options:["Dawn","Midday","Sunset","Midnight"],correct:0,explanation:"Bhairav belongs to the morning ragas, evoking serenity at daybreak.",difficulty:"Masters"},
    {question:"Which ancient university, a center of Buddhist learning, was located in Bihar?",options:["Taxila","Vikramashila","Nalanda","Ujjain"],correct:2,explanation:"Nalanda flourished from the 5th to 12th centuries as a major monastic university.",difficulty:"Masters"},
    {question:"The Indian Space Research Organisation's Mars Orbiter Mission achieved orbit in which year?",options:["2010","2014","2016","2018"],correct:1,explanation:"Mangalyaan entered Martian orbit in September 2014 on its first attempt.",difficulty:"Masters"},
    {question:"The Sangam literature is primarily composed in which language?",options:["Prakrit","Kannada","Tamil","Pali"],correct:2,explanation:"The corpus of Sangam poetry represents an early classical phase of Tamil.",difficulty:"Masters"},
    {question:"Which river is known as the 'Dakshin Ganga'?",options:["Godavari","Kaveri","Krishna","Mahanadi"],correct:0,explanation:"The Godavari, India's second-longest river, is often termed the Ganges of the South.",difficulty:"Masters"},
    {question:"The Battle of Plassey in 1757 marked the rise of which colonial power in India?",options:["French","Dutch","British","Portuguese"],correct:2,explanation:"Clive's victory for the British East India Company established British dominance in Bengal.",difficulty:"Masters"},
    {question:"Which Indian state currently boasts the highest Human Development Index?",options:["Kerala","Maharashtra","Gujarat","Tamil Nadu"],correct:0,explanation:"Kerala consistently tops India's HDI rankings due to strong health and education metrics.",difficulty:"Masters"},
    {question:"The Great Bath, an early example of public water architecture, was found at which Indus Valley site?",options:["Harappa","Mohenjo-daro","Lothal","Dholavira"],correct:1,explanation:"The Great Bath is a prominent structure at Mohenjo-daro, suggesting ritual bathing.",difficulty:"Masters"},
    {question:"The Raman effect, which earned a Nobel Prize, was discovered by?",options:["C. V. Raman","S. Chandrasekhar","Homi Bhabha","Meghnad Saha"],correct:0,explanation:"Sir C. V. Raman observed inelastic scattering of light, later named the Raman effect.",difficulty:"Masters"},
    {question:"Who popularized the slogan 'Swaraj is my birthright'?",options:["Mahatma Gandhi","Bal Gangadhar Tilak","Jawaharlal Nehru","Sardar Patel"],correct:1,explanation:"Bal Gangadhar Tilak used the slogan to demand self-rule during the independence movement.",difficulty:"Masters"},
    {question:"Bhakra Nangal Dam harnesses which river?",options:["Yamuna","Narmada","Sutlej","Godavari"],correct:2,explanation:"Constructed across the Sutlej, Bhakra Nangal is among India's tallest gravity dams.",difficulty:"Masters"}
  ],
  geography: [
    {question:"Atlantic thermohaline circulation is primarily driven by?",options:["Temperature gradients","Salinity and density differences","Wind shear","Lunar tides"],correct:1,explanation:"Deep water formation near Greenland arises from salty, cold, dense water sinking.",difficulty:"Masters"},
    {question:"Loess deposits are largely composed of?",options:["Volcanic ash","Glacial silt","Desert sand","Organic peat"],correct:1,explanation:"Fine silt blown from Pleistocene outwash plains accumulates as loess.",difficulty:"Masters"},
    {question:"The Pacific 'Ring of Fire' is notable for?",options:["Coral reefs","Tropical storms","Frequent earthquakes and volcanoes","Strong trade winds"],correct:2,explanation:"Subduction zones encircling the Pacific generate intense seismic and volcanic activity.",difficulty:"Masters"},
    {question:"Karst topography forms chiefly through dissolution of?",options:["Basalt","Granite","Limestone","Gneiss"],correct:2,explanation:"Acidic water dissolves carbonate rocks, creating sinkholes and caves.",difficulty:"Masters"},
    {question:"Which K√∂ppen classification denotes Mediterranean climates?",options:["Af","Csa/Csb","Dfa","ET"],correct:1,explanation:"Dry summers and wet winters typify the temperate Cs zones.",difficulty:"Masters"},
    {question:"The world's largest inland delta, the Okavango, empties into which desert?",options:["Gobi","Kalahari","Atacama","Thar"],correct:1,explanation:"Seasonal floodwaters of the Okavango River spread across Botswana's Kalahari Desert.",difficulty:"Masters"},
    {question:"Which current moderates Western Europe's climate by transporting warm water from the Gulf of Mexico?",options:["Canary Current","Gulf Stream","Benguela Current","Kuroshio Current"],correct:1,explanation:"The Gulf Stream carries warm Atlantic water northeastward, softening Europe's winters.",difficulty:"Masters"},
    {question:"A graben is best described as?",options:["Raised fault block","Folded mountain","Down-dropped fault block","Glacial valley"],correct:2,explanation:"Graben result when crustal blocks subside between parallel normal faults.",difficulty:"Masters"},
    {question:"Which country has the most natural lakes?",options:["Canada","Finland","Russia","United States"],correct:0,explanation:"Canada contains nearly 60% of the world's lakes larger than 100 square kilometers.",difficulty:"Masters"},
    {question:"The concept of continental drift was first proposed by?",options:["Charles Lyell","Alfred Wegener","Harry Hess","James Hutton"],correct:1,explanation:"Wegener's 1912 theory suggested continents move over geological time, later informing plate tectonics.",difficulty:"Masters"},
    {question:"Which river forms a significant part of the border between the United States and Mexico?",options:["Colorado","Rio Grande","Columbia","Yukon"],correct:1,explanation:"The Rio Grande flows from Colorado to the Gulf of Mexico, delineating much of the US‚ÄëMexico border.",difficulty:"Masters"},
    {question:"The extreme aridity of the Atacama Desert is primarily caused by?",options:["Cold ocean currents and rain shadow","High latitude","Monsoon winds","Continental interior location"],correct:0,explanation:"The cold Humboldt Current and the Andes rain shadow suppress precipitation in the Atacama.",difficulty:"Masters"},
    {question:"Which mountain range arose from the collision of the Indian and Eurasian plates?",options:["Andes","Alps","Himalayas","Rockies"],correct:2,explanation:"The ongoing convergence of India with Eurasia uplifted the Himalayas.",difficulty:"Masters"},
    {question:"The prime meridian crosses which of the following African countries?",options:["Ghana","Nigeria","South Africa","Kenya"],correct:0,explanation:"Greenwich's meridian intersects the Gulf of Guinea and passes through Ghana.",difficulty:"Masters"},
    {question:"A volcano with broad, gently sloping sides built from fluid lava flows is known as?",options:["Stratovolcano","Cinder cone","Shield volcano","Caldera"],correct:2,explanation:"Shield volcanoes like Mauna Loa form from low‚Äëviscosity basaltic lava.",difficulty:"Masters"}
  ],
  science: [
    {question:"The Higgs mechanism endows particles with mass via interaction with the?",options:["Gauge bosons","Higgs field","Dark matter","Gravitational waves"],correct:1,explanation:"Spontaneous symmetry breaking in the Higgs field gives W and Z bosons mass.",difficulty:"Masters"},
    {question:"CRISPR-Cas9 originates from bacterial?",options:["Ribosomes","Immune defense","Transcription machinery","Plasmid replication"],correct:1,explanation:"It is an adaptive immunity system using stored viral DNA to target invaders.",difficulty:"Masters"},
    {question:"In quantum mechanics the commutator [x,p] equals?",options:["0","iƒß","-iƒß","1"],correct:1,explanation:"Canonical position-momentum operators satisfy [x,p]=iƒß, embodying uncertainty.",difficulty:"Masters"},
    {question:"According to the second law, entropy of an isolated system?",options:["Decreases","Remains constant","Increases or remains constant","Oscillates"],correct:2,explanation:"Entropy cannot decrease in isolation, underpinning arrow of time.",difficulty:"Masters"},
    {question:"Type Ia supernovae result from?",options:["Core-collapse of massive stars","Thermonuclear runaway in white dwarfs","Neutron star mergers","Accretion onto black holes"],correct:1,explanation:"A white dwarf near the Chandrasekhar limit ignites carbon explosively.",difficulty:"Masters"},
    {question:"Which gas law relates pressure to temperature for a fixed volume of gas?",options:["Boyle's law","Avogadro's law","Gay-Lussac's law","Dalton's law"],correct:2,explanation:"Gay-Lussac's law states that pressure is directly proportional to absolute temperature at constant volume.",difficulty:"Masters"},
    {question:"In molecular biology, what is the role of telomerase?",options:["Repair DNA breaks","Synthesize RNA primers","Extend chromosome ends","Ligate Okazaki fragments"],correct:2,explanation:"Telomerase adds repetitive sequences to telomeres, countering chromosomal shortening.",difficulty:"Masters"},
    {question:"Which particle mediates the strong nuclear force?",options:["Photon","Gluon","Z boson","Graviton"],correct:1,explanation:"Gluons exchange color charge between quarks in quantum chromodynamics.",difficulty:"Masters"},
    {question:"The Miller-Urey experiment tested hypotheses about?",options:["Formation of the moon","Spontaneous generation","Chemical origin of life","Plate tectonics"],correct:2,explanation:"The 1953 experiment produced amino acids by simulating early Earth's reducing atmosphere.",difficulty:"Masters"},
    {question:"According to general relativity, gravity arises from?",options:["Electromagnetic waves","Spacetime curvature","Quantum tunneling","Graviton exchange"],correct:1,explanation:"Mass-energy curves spacetime, and free-falling objects follow geodesic paths.",difficulty:"Masters"}
  ],
  history: [
    {question:"The Treaty of Westphalia in 1648 ended which conflict?",options:["Thirty Years' War","Hundred Years' War","War of the Roses","English Civil War"],correct:0,explanation:"The Treaty of Westphalia concluded the Thirty Years' War, shaping modern state sovereignty.",difficulty:"Masters"},
    {question:"Who was the first female pharaoh of ancient Egypt?",options:["Cleopatra VII","Nefertiti","Hatshepsut","Sobekneferu"],correct:2,explanation:"Hatshepsut ruled as pharaoh in the 15th century BCE, expanding trade and building monuments.",difficulty:"Masters"}
  ],
  arts: [
    {question:"Which art movement is characterized by small, thin brush strokes and open composition?",options:["Impressionism","Cubism","Baroque","Surrealism"],correct:0,explanation:"Impressionism captures light and movement with loose brushwork and vivid colors.",difficulty:"Masters"}
  ],
  tolkien: [
    {question:"Who forged the One Ring?",options:["Sauron","Celebrimbor","Saruman","Melkor"],correct:0,explanation:"Sauron created the Ruling Ring in the fires of Mount Doom to dominate the other Rings of Power.",difficulty:"Masters"},
    {question:"The Battle of Five Armies concludes which novel?",options:["The Fellowship of the Ring","The Two Towers","The Hobbit","The Silmarillion"],correct:2,explanation:"The climactic battle at Erebor occurs near the end of 'The Hobbit'.",difficulty:"Masters"},
    {question:"What is the name of Gandalf's sword?",options:["Glamdring","And√∫ril","Sting","Orcrist"],correct:0,explanation:"Gandalf wields Glamdring, forged in Gondolin and rediscovered in 'The Hobbit'.",difficulty:"Masters"},
    {question:"After Th√©oden's death, who becomes King of Rohan?",options:["√âomer","√âowyn","Th√©odred","Gr√≠ma Wormtongue"],correct:0,explanation:"√âomer succeeds his uncle Th√©oden as King of the Rohirrim.",difficulty:"Masters"},
    {question:"The Silmarils were crafted from a crystal substance known as?",options:["Mithril","Silima","Adamant","Ithildin"],correct:1,explanation:"F√´anor wrought the Silmarils from the unique crystal silima, capturing the light of the Two Trees.",difficulty:"Masters"},
    {question:"Which river forms the eastern boundary of the Shire?",options:["Brandywine","Anduin","Isen","Greyflood"],correct:0,explanation:"The Brandywine River, called Baranduin by Elves, marks the Shire's eastern edge.",difficulty:"Masters"},
    {question:"In Tolkien's legendarium, who guides the Sun across the sky?",options:["Arien","Tilion","E√∂nw√´","Uinen"],correct:0,explanation:"Arien, a Maia of fire, steers the vessel of the Sun in the heavens.",difficulty:"Masters"}
  ],
  wortschatz: [
    {question:"Deutsch ‚Üí Englisch: 'veranschaulichen'",options:["to exemplify","to legislate","to retreat","to harvest"],correct:0,explanation:"'Veranschaulichen' means to illustrate or exemplify an idea.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'nachhaltig'",options:["sustainable","subsequent","suspicious","nocturnal"],correct:0,explanation:"'Nachhaltig' is used for environmentally sustainable practices.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'entt√§uschen'",options:["to disappoint","to share","to inherit","to guess"],correct:0,explanation:"'Entt√§uschen' translates as to disappoint or let someone down.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: '√ºberpr√ºfen'",options:["to ignore","to verify","to resign","to announce"],correct:1,explanation:"'√úberpr√ºfen' means to check or verify information.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'berechtigt'",options:["entitled","embarrassed","scattered","moist"],correct:0,explanation:"'Berechtigt' conveys a sense of being justified or entitled.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'voraussetzen'",options:["to predict","to assume","to postpone","to submit"],correct:1,explanation:"'Voraussetzen' means to take for granted or assume something.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: '√§hneln'",options:["to resemble","to issue","to decorate","to escape"],correct:0,explanation:"'√Ñhneln' translates as to resemble or look like.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'verzichtbar'",options:["indispensable","dispensable","agreeable","breakable"],correct:1,explanation:"'Verzichtbar' describes something that is not essential or can be done without.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'Einschr√§nkung'",options:["expansion","privilege","restriction","instruction"],correct:2,explanation:"'Einschr√§nkung' denotes a limitation or restriction.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'beeintr√§chtigen'",options:["to impair","to demonstrate","to compose","to empower"],correct:0,explanation:"'Beeintr√§chtigen' means to impair or negatively affect something.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'widerspiegeln'",options:["to finance","to reflect","to negotiate","to merge"],correct:1,explanation:"'Widerspiegeln' translates as to reflect or mirror something.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'umstritten'",options:["controversial","relaxed","delayed","thirsty"],correct:0,explanation:"'Umstritten' describes something disputed or controversial.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'ausreichen'",options:["to surf","to suffice","to relocate","to translate"],correct:1,explanation:"'Ausreichen' means to be enough or suffice.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'vermeiden'",options:["to avoid","to permit","to rent","to admire"],correct:0,explanation:"'Vermeiden' corresponds to avoid or shun.",difficulty:"B2"},
    {question:"Deutsch ‚Üí Englisch: 'Herstellung'",options:["production","independence","heritage","hearing"],correct:0,explanation:"'Herstellung' refers to the production or manufacture of something.",difficulty:"B2"}
  ],
};

/* ---------- Pad categories to 100 questions ---------- */
(function padBank(){
  const cats = [
    ["india","Masters"],
    ["geography","Masters"],
    ["science","Masters"],
    ["history","Masters"],
    ["arts","Masters"],
    ["tolkien","Masters"],
    ["wortschatz","B2"]
  ];
  for (const [cat,diff] of cats){
    BANK[cat] = BANK[cat] || [];
    const base = BANK[cat].slice();
    for (let i = BANK[cat].length; i < 100; i++){
      const q = base[i % base.length];
      BANK[cat].push({...q});
    }
  }
})();

/* ---------- Merge embedded payload (one-file backups) ---------- */
(function mergeEmbedded(){
  try{
    const raw = document.getElementById('embeddedBank')?.textContent || '{}';
    const obj = JSON.parse(raw);
    if (obj && typeof obj==='object'){
      for (const k of Object.keys(obj)){
        if (Array.isArray(obj[k]) && obj[k].length) BANK[k] = obj[k];
      }
    }
  }catch{}
})();

/* ---------- Local overrides (browser) ---------- */
(function loadLocal(){
  try{
    const x = JSON.parse(localStorage.getItem('BANK_LOCAL')||'null');
    if (x && typeof x==='object'){
      for (const k of Object.keys(x)) if (Array.isArray(x[k])) BANK[k]=x[k];
    }
  }catch{}
})();

/* ---------- UI helpers ---------- */
const $  = s => document.querySelector(s);
const $$ = s => [...document.querySelectorAll(s)];
function show(id){ ["#screen-home","#screen-game"].forEach(s=>$(s).classList.add("hidden")); $(id).classList.remove("hidden"); }
function updateHomeCounts(){ for (const k of Object.keys(BANK)){ const n = BANK[k]?.length||0; const el = document.querySelector(`[data-count="${k}"]`); if (el) el.textContent = n; } }
updateHomeCounts();
if (new URLSearchParams(location.search).get('admin') === '1') { const p = document.getElementById('adminPanel'); if (p) p.style.display = ''; }

/* ---------- Game logic ---------- */
const ROUND_COUNT = 10;
const PER_Q = 45;
let state = {cat:null, deck:[], idx:0, score:0, t:PER_Q, id:null, answered:false};

function shuffle(a){ for (let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function pickN(arr,n){ const copy=[...(arr||[])]; shuffle(copy); return copy.slice(0, Math.min(n, copy.length)); }

function startGame(cat){
  const deck = pickN(BANK[cat]||[], ROUND_COUNT);
  if (!deck.length){ alert("No questions in this category yet."); return; }
  state = {cat, deck, idx:0, score:0, t:PER_Q, id:null, answered:false};
  $("#btnHome").classList.remove("hidden");
  show("#screen-game"); renderQ(); startTimer();
}
function renderQ(){
  const q = state.deck[state.idx];
  $("#hudCatName").textContent = state.cat;
  $("#hudCounter").textContent = `Q ${state.idx+1} / ${state.deck.length}`;
  $("#hudScore").textContent   = `Score: ${state.score}/${state.deck.length}`;
  $("#hudProgress").style.width = `${(state.idx/state.deck.length)*100}%`;
  $("#hudTimer").textContent   = `${state.t}s`;
  $("#qText").textContent      = q.question;
  $("#explain").textContent    = "";
  const wrap = $("#opts"); wrap.innerHTML = "";
  q.options.forEach((opt,i)=>{
    const d = document.createElement("div");
    d.className="opt"; d.textContent=opt; d.onclick = ()=> choose(i);
    wrap.appendChild(d);
  });
}
function choose(i){
  if (state.answered) return; state.answered = true;
  const q = state.deck[state.idx]; const nodes = [...$("#opts").children];
  nodes.forEach((n,idx)=>{ if (idx===q.correct) n.classList.add("correct"); if (idx===i && i!==q.correct) n.classList.add("wrong"); });
  if (i===q.correct) state.score++;
  $("#explain").textContent = q.explanation||"";
}
function startTimer(){
  clearInterval(state.id); state.t = PER_Q;
  state.id = setInterval(()=>{ state.t--; $("#hudTimer").textContent = `${state.t}s`; if (state.t<=0){ state.answered=true; next(); } },1000);
}
function next(){
  if (state.idx < state.deck.length-1){
    state.idx++; state.answered=false; state.t=PER_Q; renderQ(); startTimer();
  }else{
    clearInterval(state.id);
    alert(`Finished! Score ${state.score}/${state.deck.length}`);
    $("#btnHome").classList.add("hidden"); show("#screen-home");
  }
}

/* Buttons */
$$('[data-start]').forEach(b=> b.onclick = ()=> startGame(b.getAttribute('data-start')));
$("#btnHome").onclick = ()=>{ clearInterval(state.id); $("#btnHome").classList.add("hidden"); show("#screen-home"); };
$("#btnNext").onclick  = next;
$("#btnReveal").onclick= ()=>{ if (!state.answered){ choose(state.deck[state.idx].correct); } };

/* ---------- Admin: import/export, one-file backup (LOCAL ONLY) ---------- */
function csvToObjects(text){
  const lines = text.replace(/\r/g,'').split('\n').filter(Boolean);
  if (!lines.length) return [];
  const head = lines.shift().split(',').map(s=>s.trim());
  return lines.map(row=>{
    const cols = row.split(',').map(s=>s.trim()); const obj = {};
    head.forEach((h,i)=>obj[h]=cols[i] ?? '');
    return {
      question: obj.question,
      options: [obj.optionA, obj.optionB, obj.optionC, obj.optionD],
      correct: Number(obj.correct||0),
      explanation: obj.explanation||'',
      difficulty: obj.difficulty||'Masters',
      category: obj.category||''
    };
  });
}
function validateQ(q){
  return q && typeof q.question==='string' && q.question.trim()
      && Array.isArray(q.options) && q.options.length===4
      && [0,1,2,3].includes(q.correct);
}
function dedupeMerge(targetArr, incoming){
  const seen = new Set(targetArr.map(x=>x.question.trim().toLowerCase()));
  let add=0, skip=0, bad=0;
  for (const q of incoming){
    if (!validateQ(q)) { bad++; continue; }
    const key = q.question.trim().toLowerCase();
    if (seen.has(key)) { skip++; continue; }
    targetArr.push(q); seen.add(key); add++;
  }
  return {add,skip,bad};
}
function saveLocal(){ try{ localStorage.setItem('BANK_LOCAL', JSON.stringify(BANK)); }catch{} }
function download(name, text, type='application/json'){
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([text],{type})); a.download = name; a.click(); URL.revokeObjectURL(a.href);
}
const elCat=$("#impCat"), elFile=$("#impFile"), msg=$("#impMsg");

$("#btnImport")?.addEventListener('click', async ()=>{
  const cat = elCat.value; const f = elFile.files[0];
  if (!f){ msg.textContent='Choose a .json or .csv file.'; return; }
  const txt = await f.text(); let arr = [];
  try{ arr = f.name.toLowerCase().endsWith('.csv') ? csvToObjects(txt) : JSON.parse(txt); }
  catch(e){ msg.textContent='Parse error: '+e.message; return; }
  if (!Array.isArray(arr)){ msg.textContent='File must be an array of questions.'; return; }
  BANK[cat] = BANK[cat]||[]; const res = dedupeMerge(BANK[cat], arr);
  saveLocal(); updateHomeCounts();
  msg.textContent = `Imported into "${cat}": +${res.add} added, ${res.skip} duplicates, ${res.bad} invalid. Total ${BANK[cat].length}.`;
});

$("#btnImportAll")?.addEventListener('click', async ()=>{
  const f = elFile.files[0]; if (!f){ msg.textContent='Choose an ALL JSON first.'; return; }
  try{
    const obj = JSON.parse(await f.text());
    if (!obj || typeof obj!=='object') throw new Error('Not an object');
    for (const k of Object.keys(obj)) if (Array.isArray(obj[k])) BANK[k]=obj[k];
    saveLocal(); updateHomeCounts(); msg.textContent='Imported ALL categories.';
  }catch(e){ msg.textContent='Parse error: '+e.message; }
});

$("#btnExportCat")?.addEventListener('click', ()=>{
  const cat = elCat.value; download(`${cat}.json`, JSON.stringify(BANK[cat]||[], null, 2));
});
$("#btnExportAll")?.addEventListener('click', ()=>{
  download(`all_categories.json`, JSON.stringify(BANK, null, 2));
});
$("#btnClearLocal")?.addEventListener('click', ()=>{
  localStorage.removeItem('BANK_LOCAL'); msg.textContent='Local overrides cleared. Reload to use embedded data.';
});
$("#btnOneFile")?.addEventListener('click', ()=>{
  try{
    const doc = document.cloneNode(true);
    const el = doc.getElementById('embeddedBank'); if (el) el.textContent = JSON.stringify(BANK, null, 2);
    const html = '<!DOCTYPE html>\n' + doc.documentElement.outerHTML;
    download('triviaquest_onefile_backup.html', html, 'text/html');
    msg.textContent='One-file backup downloaded.';
  }catch(e){ msg.textContent='Backup failed: '+e.message; }
});
</script>
</div>
</body>
</html>
